{"version":3,"file":"src_screens_BaseDriveScreen_index_tsx.chunk.bundle","mappings":"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","sources":["webpack:///./node_modules/react-native-iphone-x-helper/index.js","webpack:///./src/components/HeaderClose.tsx","webpack:///./src/screens/BaseDriveScreen/index.tsx"],"sourcesContent":["import { Dimensions, Platform, StatusBar } from 'react-native';\n\nexport function isIphoneX() {\n    const dimen = Dimensions.get('window');\n    return (\n        Platform.OS === 'ios' &&\n        !Platform.isPad &&\n        !Platform.isTVOS &&\n        ((dimen.height === 780 || dimen.width === 780)\n          || (dimen.height === 812 || dimen.width === 812)\n          || (dimen.height === 844 || dimen.width === 844)\n          || (dimen.height === 896 || dimen.width === 896)\n          || (dimen.height === 926 || dimen.width === 926))\n    );\n}\n\nexport function ifIphoneX(iphoneXStyle, regularStyle) {\n    if (isIphoneX()) {\n        return iphoneXStyle;\n    }\n    return regularStyle;\n}\n\nexport function getStatusBarHeight(safe) {\n    return Platform.select({\n        ios: ifIphoneX(safe ? 44 : 30, 20),\n        android: StatusBar.currentHeight,\n        default: 0\n    });\n}\n\nexport function getBottomSpace() {\n    return isIphoneX() ? 34 : 0;\n}\n","import React, {memo, ReactElement} from 'react';\nimport {styled} from \"@true/core\";\nimport { IC_OUTLINED_CLOSE} from \"@true/asset\";\nimport { Fonts, goBack } from \"@true/core\";\n\nconst Container = styled.View<{ withDivider?: boolean }>`\n  height: ${p => p.theme.statusHeight + 56}px;\n  background-color: ${p=>p.theme.backgroundColor};\n  padding-top: ${p => p.theme.statusHeight}px;\n  flex-direction: row;\n  align-items: center;\n  border-bottom-width: ${p => p.withDivider ? 1 : 0}px;\n  border-bottom-color: ${p=>p.theme.grey5}50;\n`;\n\nconst Center = styled.View`\n  flex: 1;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  padding-left: ${(16)}px;\n`;\n\nconst Right = styled.TouchableOpacity`\n  width: ${(60)}px;\n  height: 100%;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-end;\n  padding-right: ${(16)}px;\n`;\n\nconst Icon = styled.Image`\n  width: ${(24)}px;\n  height: ${(24)}px;\n  tint-color: ${p=>p.theme.grey2};\n`;\n\n\nconst BannerText = styled.Text`\n  font-size: ${(18)}px;\n  color: ${p=>p.theme.grey1};\n  font-family: ${Fonts.Bold};\n`;\n\ninterface Props {\n    title: string,\n    withDivider?: boolean;\n    right?: ReactElement\n}\n\nexport const HeaderClose = memo(function HeaderClose(props: Props) {\n    const {title, withDivider} = props;\n    return (\n        <Container withDivider={withDivider}>\n            <Center>\n                <BannerText numberOfLines={1}>\n                    {title}\n                </BannerText>\n            </Center>\n            <Right onPress={goBack}>\n                <Icon source={IC_OUTLINED_CLOSE} />\n            </Right>\n        </Container>\n    )\n});\n","import React, {memo, useCallback, useMemo} from 'react';\nimport {WebView as RNWebView} from 'react-native-webview';\nimport {ActivityIndicator, Alert, View} from 'react-native';\nimport {getBottomSpace, getStatusBarHeight} from 'react-native-iphone-x-helper';\nimport { useNavigationParams } from '@true/core';\nimport { Core, Fetch } from '@true/core';\nimport { goBack } from '@true/core';\nimport { HeaderClose } from \"@/components/HeaderClose\";\n\nexport interface BaseDriveFile {\n  ext: string;\n  fid: string;\n  from_base_drive: 0 | 1;\n  is_image: 0 | 1;\n  metatype: 'base';\n  name: string;\n  preview: string; // url\n  refid: string; //number\n  size: number;\n  src: string;\n}\n\nconst LoadingIndicator = (\n  <ActivityIndicator\n    size=\"large\"\n    style={{\n      position: 'absolute',\n      zIndex: 1,\n      top: 16 + getStatusBarHeight(true),\n      right: 16,\n    }}\n  />\n);\n\nconst injectedJavascript = `(function() {\n  parent = window;\n  window.postMessage = function(data) {\n    window.ReactNativeWebView.postMessage(JSON.stringify(data));\n  };\n})()`;\n\nconst renderLoading = () => LoadingIndicator;\n\nexport interface BaseDriveScreenParams {\n  multi?: number;\n  onFiles?: (files: BaseDriveFile[]) => any;\n}\n\nexport const BaseDriveScreen = memo(function BaseDriveScreen() {\n  const {multi = 1, onFiles,} = useNavigationParams<BaseDriveScreenParams>()\n\n  const source = useMemo(() => {\n    const baseToken =\n      '_uuid' +\n      Math.random()\n        .toString(32)\n        .substring(2);\n    const params = {\n      access_token: Core.accessToken,\n      __code: 'native',\n      multi: multi,\n      ext: 1,\n      base_token: baseToken,\n    };\n\n    const extParams = Object.keys(params)\n      // @ts-ignore\n      .map(key => `${key}=${params[key]}`)\n      .join('&');\n\n    const uri = Fetch.__getRealUrl(\n      `@drive/picker?${extParams}&base_domain=https%3A%2F%2Fmessage.${Core.sysUrl}`,\n    );\n\n    return {uri};\n  }, [multi]);\n\n  const onMessage = useCallback((event:any) => {\n    try {\n      const data = JSON.parse(event.nativeEvent.data);\n      const files = data.files as BaseDriveFile[];\n      if (files?.length) {\n        onFiles?.(files);\n        goBack()\n      }\n\n    } catch (e:any) {\n      Alert.alert(e.toString(), \"\")\n    }\n  }, [onFiles]);\n\n  return (\n    <View style={{flex:1}}>\n      <HeaderClose title={'Base Drive'}/>\n      <RNWebView\n        source={source}\n        onMessage={onMessage}\n        renderLoading={renderLoading}\n        domStorageEnabled={true}\n        allowsInlineMediaPlayback={true}\n        sharedCookiesEnabled={false}\n        thirdPartyCookiesEnabled={false}\n        startInLoadingState={true}\n        injectedJavaScriptBeforeContentLoaded={injectedJavascript}\n      />\n      <View style={{width: '100%', height: getBottomSpace()}}/>\n    </View>\n  );\n});\n\nexport default BaseDriveScreen;\n"],"names":["isIphoneX","safe","Platform","select","ios","ifIphoneX","android","StatusBar","currentHeight","default","_reactNative","require","dimen","Dimensions","get","OS","isPad","isTVOS","height","width","iphoneXStyle","regularStyle","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","_react","obj","nodeInterop","__esModule","cache","_getRequireWildcardCache","has","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","_core","_asset","_jsxRuntime","WeakMap","cacheBabelInterop","cacheNodeInterop","Container","styled","View","_taggedTemplateLiteralLoose2","p","theme","statusHeight","backgroundColor","withDivider","grey5","Center","Right","TouchableOpacity","Icon","Image","grey2","BannerText","Text","grey1","Fonts","Bold","exports","memo","props","title","jsxs","children","jsx","numberOfLines","onPress","goBack","source","IC_OUTLINED_CLOSE","_reactNativeWebview","_reactNativeIphoneXHelper","_HeaderClose","LoadingIndicator","ActivityIndicator","size","style","position","zIndex","top","getStatusBarHeight","right","renderLoading","BaseDriveScreen","_useNavigationParams","useNavigationParams","_useNavigationParams$","multi","onFiles","useMemo","baseToken","Math","random","toString","substring","params","access_token","Core","accessToken","__code","ext","base_token","extParams","keys","map","join","uri","Fetch","__getRealUrl","sysUrl","onMessage","useCallback","event","files","JSON","parse","nativeEvent","data","length","e","Alert","alert","flex","HeaderClose","WebView","domStorageEnabled","allowsInlineMediaPlayback","sharedCookiesEnabled","thirdPartyCookiesEnabled","startInLoadingState","injectedJavaScriptBeforeContentLoaded","getBottomSpace"],"sourceRoot":""}